# coding=UTF-8
# ex:ts=4:sw=4:et=on

from PySide6.QtCore import Signal
from PySide6.QtWidgets import QWidget, QHBoxLayout, QLineEdit, QPushButton, QFileDialog


class QtFileChooserButton(QWidget):
    """
    Compound widget: QLineEdit + Browse QPushButton → QFileDialog.
    Equivalent of the GTK FileChooserButton widget.
    """
    fileChanged = Signal(str)

    def __init__(self, mode="open", parent=None):
        super().__init__(parent)
        self._mode = mode  # "open" or "save"
        layout = QHBoxLayout(self)
        layout.setContentsMargins(0, 0, 0, 0)

        self._entry = QLineEdit(self)
        self._button = QPushButton("Browse…", self)
        layout.addWidget(self._entry, stretch=4)
        layout.addWidget(self._button, stretch=1)

        self._button.clicked.connect(self._open_dialog)
        self._entry.textChanged.connect(self.fileChanged)

    def _open_dialog(self):
        if self._mode == "save":
            path, _ = QFileDialog.getSaveFileName(self, "Save File")
        else:
            path, _ = QFileDialog.getOpenFileName(self, "Open File")
        if path:
            self._entry.setText(path)

    def get_filename(self):
        return self._entry.text()

    def set_filename(self, path):
        self._entry.setText(str(path) if path else "")
