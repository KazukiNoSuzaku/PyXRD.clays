# coding=UTF-8
# ex:ts=4:sw=4:et=on

from PySide6.QtCore import Signal
from PySide6.QtGui import QColor
from PySide6.QtWidgets import QPushButton, QColorDialog


class QtColorButton(QPushButton):
    """
    A button that opens a QColorDialog when clicked
    and displays the chosen color as its background.
    """
    colorChanged = Signal(str)  # emits hex color string

    def __init__(self, parent=None):
        super().__init__(parent)
        self._color = QColor("#000000")
        self._update_style()
        self.clicked.connect(self._open_dialog)

    def _open_dialog(self):
        color = QColorDialog.getColor(self._color, self, "Select Color")
        if color.isValid():
            self._color = color
            self._update_style()
            self.colorChanged.emit(color.name())

    def _update_style(self):
        self.setStyleSheet(
            "background-color: %s; border: 1px solid #888;" % self._color.name()
        )

    def get_color(self):
        return self._color.name()

    def set_color(self, value):
        color = QColor(str(value)) if not isinstance(value, QColor) else value
        if color.isValid():
            self._color = color
            self._update_style()
