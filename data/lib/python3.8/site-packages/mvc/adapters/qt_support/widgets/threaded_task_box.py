# coding=UTF-8
# ex:ts=4:sw=4:et=on

from PySide6.QtCore import Signal
from PySide6.QtWidgets import (QWidget, QVBoxLayout, QHBoxLayout,
                                QProgressBar, QPushButton, QLabel)


class QtThreadedTaskBox(QWidget):
    """
    Progress display widget with cancel/stop buttons.
    Equivalent of the GTK ThreadedTaskBox widget.
    """
    cancelrequested = Signal()
    stoprequested = Signal()

    def __init__(self, parent=None):
        super().__init__(parent)
        layout = QVBoxLayout(self)

        self._label = QLabel("", self)
        layout.addWidget(self._label)

        self._progress = QProgressBar(self)
        self._progress.setRange(0, 100)
        layout.addWidget(self._progress)

        btn_layout = QHBoxLayout()
        self._cancel_btn = QPushButton("Cancel", self)
        self._stop_btn = QPushButton("Stop", self)
        btn_layout.addWidget(self._cancel_btn)
        btn_layout.addWidget(self._stop_btn)
        layout.addLayout(btn_layout)

        self._cancel_btn.clicked.connect(self.cancelrequested)
        self._stop_btn.clicked.connect(self.stoprequested)

    def set_status(self, text):
        self._label.setText(text)

    def set_progress(self, value):
        """Set progress 0-100."""
        self._progress.setValue(int(value))

    def set_cancel_visible(self, visible):
        self._cancel_btn.setVisible(visible)

    def set_stop_visible(self, visible):
        self._stop_btn.setVisible(visible)
