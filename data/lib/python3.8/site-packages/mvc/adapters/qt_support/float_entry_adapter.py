# coding=UTF-8
# ex:ts=4:sw=4:et=on

from PySide6.QtWidgets import QLineEdit
from PySide6.QtGui import QDoubleValidator
from .basic import QtAdapter


def _read_float(w):
    try:
        return float(w.text())
    except (ValueError, TypeError):
        return 0.0


def _write_float(w, v):
    try:
        w.setText("%g" % float(v))
    except (ValueError, TypeError):
        w.setText("0")


class FloatEntryAdapter(QtAdapter):
    """Adapter for float-valued QLineEdit widgets."""
    widget_types = ["float_entry"]
    _check_widget_type = QLineEdit

    _wid_read = lambda c, w: _read_float(w)
    _wid_write = lambda c, w, v: _write_float(w, v)
    _signal = "editingFinished"

    def _connect_widget(self):
        # Install a floating-point validator
        self._widget.setValidator(QDoubleValidator())
        super()._connect_widget()

    pass  # end of class
