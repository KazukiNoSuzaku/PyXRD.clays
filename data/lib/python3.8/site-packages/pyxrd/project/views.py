# coding=UTF-8
# ex:ts=4:sw=4:et=on

# Copyright (c) 2013, Mathijs Dumon
# All rights reserved.
# Complete license can be found in the LICENSE file.

from pkg_resources import resource_filename  # @UnresolvedImport

from PySide6.QtGui import QCursor
from PySide6.QtWidgets import QMenu

from pyxrd.generic.views import DialogView

class ProjectView(DialogView):
    title = "Edit Project"
    subview_builder = resource_filename(__name__, "ui/project.ui")
    subview_toplevel = "project_container"
    resizable = False

    widget_format = "project_%s"

    widget_groups = {
        'full_mode_only': [
            "algn_calc_color",
            "lbl_calccolor",
            "algn_calc_lw",
            "calc_lw_lbl"
        ]
    }

    _specimens_context_menu = None

    @property
    def specimens_treeview_container(self):
        return self["vbox_specimens"]

    @property
    def specimens_treeview(self):
        return self["project_specimens"]

    def __init__(self, *args, **kwargs):
        DialogView.__init__(self, *args, **kwargs)
        # Context menu is built by the controller via set_specimens_context_menu()

    def set_specimens_context_menu(self, menu):
        self._specimens_context_menu = menu

    def present(self, *args, **kwargs):
        super(ProjectView, self).present(*args, **kwargs)
        nb = self["nbk_edit_project"]
        if nb is not None:
            nb.setCurrentIndex(0)

    def show_specimens_context_menu(self, event=None):
        if self._specimens_context_menu is not None:
            self._specimens_context_menu.exec(QCursor.pos())

    def hide_specimens_context_menu(self):
        if self._specimens_context_menu is not None:
            self._specimens_context_menu.hide()

    def set_x_range_sensitive(self, sensitive):
        w = self["box_manual_xrange"]
        if w is not None:
            w.setEnabled(sensitive)

    def set_y_range_sensitive(self, sensitive):
        w = self["box_manual_yrange"]
        if w is not None:
            w.setEnabled(sensitive)

    def set_selection_state(self, value):
        if value is None:
            self.hide_specimens_context_menu()

    pass # end of class
