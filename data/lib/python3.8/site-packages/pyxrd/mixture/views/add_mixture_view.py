# coding=UTF-8
# ex:ts=4:sw=4:et=on

# Copyright (c) 2013, Mathijs Dumon
# All rights reserved.
# Complete license can be found in the LICENSE file.

import os as _os
_resource_filename = lambda path: _os.path.normpath(
    _os.path.join(_os.path.dirname(_os.path.abspath(__file__)), path))
resource_filename = lambda _n, path: _resource_filename(path)

from PySide6.QtWidgets import QRadioButton, QButtonGroup, QVBoxLayout

from pyxrd.generic.views import DialogView


class AddMixtureView(DialogView):
    title = "Add Mixture"
    subview_builder = resource_filename(__name__, "ui/add_mixture.ui")
    subview_toplevel = "add_mixture_container"

    active_type = "mixture"  # | insitu

    def __init__(self, type_dict, *args, **kwargs):
        DialogView.__init__(self, *args, **kwargs)
        self.type_dict = type_dict
        self.active_type = list(type_dict.keys())[0]
        self.create_radios()

    def create_radios(self):
        box = self["add_mixture_box"]
        if box is None:
            return

        layout = box.layout()
        if layout is None:
            layout = QVBoxLayout(box)
            layout.setContentsMargins(0, 0, 0, 0)

        # Remove any existing widgets
        while layout.count():
            item = layout.takeAt(0)
            if item.widget():
                item.widget().deleteLater()

        self.button_group = QButtonGroup()
        self.radios = []
        first = True
        for mixture_type, label in self.type_dict.items():
            radio = QRadioButton(label)
            radio.mixture_type = mixture_type
            if first:
                radio.setChecked(True)
                first = False
            self.button_group.addButton(radio)
            self.radios.append(radio)
            radio.toggled.connect(self.on_rdb_toggled)
            layout.addWidget(radio)

    def get_mixture_type(self):
        return self.active_type

    def on_rdb_toggled(self, checked):
        if checked:
            for radio in self.radios:
                if radio.isChecked():
                    self.active_type = radio.mixture_type

    pass  # end of class
