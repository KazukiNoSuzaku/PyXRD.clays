# coding=UTF-8
# ex:ts=4:sw=4:et=on

# Copyright (c) 2013, Mathijs Dumon
# All rights reserved.
# Complete license can be found in the LICENSE file.

import logging
logger = logging.getLogger(__name__)

from PySide6.QtCore import Qt

from pyxrd.generic.controllers import DialogController

class AddInSituBehaviourController(DialogController):
    """
        Controller for the add InSituBehaviour dialog
    """

    auto_adapt = False

    def __init__(self, model=None, view=None, parent=None, callback=None):
        super(AddInSituBehaviourController, self).__init__(
            model=model, view=view, parent=parent)
        self.callback = callback

    def generate_combo(self):
        combo = self.view.behaviour_combo_box
        combo.clear()
        for cls, _, _ in self.parent.obj_type_map:
            combo.addItem(cls.Meta.store_id, userData=cls)

    def register_view(self, view):
        self.generate_combo()

    # ------------------------------------------------------------
    #      Signal handlers
    # ------------------------------------------------------------
    def on_btn_ok_clicked(self, event=None):
        self.view.hide()
        self.callback(self.view.get_behaviour_type())
        return True

    def on_keypress(self, widget, event):
        key = event.key() if hasattr(event, 'key') else None
        if key == Qt.Key_Escape:
            self.view.hide()
            return True
        if key in (Qt.Key_Return, Qt.Key_Enter):
            return self.on_btn_ok_clicked(event)

    def on_window_edit_dialog_delete_event(self, event=None, args=None):
        self.view.hide()
        return True  # do not propagate

    pass  # end of class
