# coding=UTF-8
# ex:ts=4:sw=4:et=on

# Copyright (c) 2013, Mathijs Dumon
# All rights reserved.
# Complete license can be found in the LICENSE file.

# Qt replacement for GTK cell-renderer helpers.
# The renderer_map and get_default_renderer exist only for API compatibility;
# actual rendering in Qt is handled by QAbstractItemDelegate subclasses or
# the default QStyledItemDelegate.

from PySide6.QtWidgets import QStyledItemDelegate

renderer_map = {
    'text':     QStyledItemDelegate,
    'accel':    QStyledItemDelegate,
    'combo':    QStyledItemDelegate,
    'spin':     QStyledItemDelegate,
    'pixbuf':   QStyledItemDelegate,
    'progress': QStyledItemDelegate,
    'spinner':  QStyledItemDelegate,
    'toggle':   QStyledItemDelegate,
}


def get_default_renderer(renderer_type, **kwargs):
    """
    Returns a renderer object.  In Qt all rendering is done through the model
    roles (DisplayRole, DecorationRole, CheckStateRole â€¦), so this just
    returns a plain QStyledItemDelegate regardless of *renderer_type*.
    The **kwargs are accepted but ignored for API compatibility.
    """
    cls = renderer_map.get(renderer_type, QStyledItemDelegate)
    if not isinstance(cls, type):
        cls = QStyledItemDelegate
    return cls()


def parse_callback(callback, reduce=True):
    """
    Parses callbacks for item delegates: splits the callback from its
    arguments if present.  If *reduce* is True and there is exactly one
    argument it is unwrapped from the tuple.

    Returns (callback, args).
    """
    args = tuple()
    try:
        callback, args = callback
    except (TypeError, ValueError):
        pass
    if reduce and len(args) == 1:
        args = args[0]
    return callback, args


def parse_kwargs(**kwargs):
    """
    Parses keyword arguments for column descriptors.

    Keys ending with ``_col`` are popped and collected into a separate
    ``col_attrs`` dict (they represent column-index mappings).
    Default xalign / yalign values are injected when absent.

    Returns ``(kwargs, col_attrs)``.
    """
    kwargs.setdefault("xalign", 0.5)
    kwargs.setdefault("yalign", 0.5)

    col_attrs = {}
    for key in list(kwargs):
        if key.endswith("_col"):
            col_attrs[key[:-4]] = kwargs.pop(key)
    return kwargs, col_attrs
