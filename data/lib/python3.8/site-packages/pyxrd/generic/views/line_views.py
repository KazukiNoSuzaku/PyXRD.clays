# coding=UTF-8
# ex:ts=4:sw=4:et=on

# Copyright (c) 2013, Mathijs Dumon
# All rights reserved.
# Complete license can be found in the LICENSE file.

import os as _os
_resource_filename = lambda path: _os.path.normpath(
    _os.path.join(_os.path.dirname(_os.path.abspath(__file__)), path))
resource_filename = lambda _n, path: _resource_filename(path)

from PySide6.QtWidgets import QFileDialog, QPushButton, QHBoxLayout

from pyxrd.generic.views import DialogView, BaseView

class CalculatedLinePropertiesView(BaseView):
    builder = resource_filename(__name__, "ui/lines/calculated_props.ui")
    top = "cal_line_props"
    widget_format = "cal_%s"

    widget_groups = {
        'full_mode_only': [
            "cal_line_props"
        ]
    }

    pass # end of class

class ExperimentalLinePropertiesView(BaseView):
    builder = resource_filename(__name__, "ui/lines/experimental_props.ui")
    top = "exp_line_props"
    widget_format = "exp_%s"

    pass # end of class

class BackgroundView(DialogView):
    title = "Remove Background"
    subview_builder = resource_filename(__name__, "ui/lines/background.ui")
    subview_toplevel = "edit_background"
    modal = True
    resizable = False

    def_bg_view = "bg_linear"
    bg_view_cont = "bg_view_container"

    def select_bg_view(self, bg_view=None):
        if bg_view is not None:
            bg_view = "bg_%s" % bg_view
        else:
            bg_view = self.def_bg_view
        self._add_child_view(self[bg_view], self[self.bg_view_cont])

    def set_file_dialog(self, dialog, callback):
        """
        Create a QPushButton that opens a file dialog, mimicking GTK's
        FileChooserButton.  *dialog* is expected to have a .filename property
        set by the callback; the callback receives (button, filename).
        """
        btn = QPushButton("Select fileâ€¦")
        def _on_clicked():
            filename, _ = QFileDialog.getOpenFileName(
                btn, "Select background pattern file")
            if filename:
                if hasattr(dialog, 'filename'):
                    dialog.filename = filename
                callback(btn, filename)
        btn.clicked.connect(_on_clicked)
        container = self["fcb_bg_container"]
        if container is not None:
            layout = container.layout()
            if layout is None:
                layout = QHBoxLayout(container)
                layout.setContentsMargins(0, 0, 0, 0)
            layout.addWidget(btn)

    pass #end of class

class AddNoiseView(DialogView):
    title = "Add Noise"
    subview_builder = resource_filename(__name__, "ui/lines/add_noise.ui")
    subview_toplevel = "add_noise"
    modal = True
    resizable = False

    pass # end of class

class SmoothDataView(DialogView):
    title = "Smooth Data"
    subview_builder = resource_filename(__name__, "ui/lines/smoothing.ui")
    subview_toplevel = "smooth_data"
    modal = True
    resizable = False

    pass # end of class

class ShiftDataView(DialogView):
    title = "Shift Pattern"
    subview_builder = resource_filename(__name__, "ui/lines/shifting.ui")
    subview_toplevel = "shift_pattern"
    modal = True
    resizable = False

    pass # end of class

class StripPeakView(DialogView):
    title = "Strip Peak"
    subview_builder = resource_filename(__name__, "ui/lines/strip_peak.ui")
    subview_toplevel = "strip_peak"
    modal = True
    resizable = False

    pass # end of class

class CalculatePeakPropertiesView(DialogView):
    title = "Calculate Peak Properties"
    subview_builder = resource_filename(__name__, "ui/lines/peak_properties.ui")
    subview_toplevel = "peak_properties"
    modal = True
    resizable = False

    pass # end of class
